import { CaseStudyViewer } from '@/components/CaseStudyViewer'
import { getCaseStudyBySlug } from '@/lib/caseStudies'
import { Figure } from '@/components/mdx/CaseStudyComponents'
import { GoalBlock } from '@/components/case-studies/GoalBlock'
import { QuoteBlock } from '@/components/case-studies/QuoteBlock'
import { SplitSection, OrbitContainer } from '@/components/case-studies/SplitSection'
import { ProseSection, ProseBlock } from '@/components/case-studies/ProseSection'
import { Heading } from '@/components/Heading'
import { OrbitingCircles } from '@/components/ui/orbiting-circles'
import { Tree, Folder, File } from '@/components/ui/file-tree'
import { Timeline } from '@/components/ui/newacetimeline'
import { Tooltip } from '@/components/ui/tooltip-card'
import { LearningCard } from '@/components/case-studies/LearningCard'
import { FocusImageGallery } from '@/components/ui/focus-image-gallery'
import { FadeIn } from '@/components/ui/fade-in'
import { Building2, Users, Network, Handshake, FileText, MessageSquare, Sparkles } from 'lucide-react'

export const metadata = {
  title: 'Social Finance Fund - Case Study',
  description: 'UX strategy + facilitation to align multi-org stakeholders and ship a usable IA/wireframe package',
}

export const sections = [
  { title: 'Context', id: 'context' },
  { title: 'The Problem', id: 'the-problem' },
  { title: 'My Role', id: 'my-role' },
  { title: 'How I Created Clarity', id: 'how-i-created-clarity' },
  { title: 'Practical AI', id: 'practical-ai' },
  { title: 'Outcomes', id: 'outcomes' },
  { title: 'Learnings', id: 'learnings' },
]

export default function SocialFinanceFundCaseStudy() {
  const caseStudy = getCaseStudyBySlug('social-finance-fund')
  
  if (!caseStudy) {
    return <div>Case study not found</div>
  }

  // Metrics data - directional stakeholder alignment outcomes
  const metrics = [
    {
      label: 'Stakeholder Alignment',
      value: 95,
      suffix: '%',
      description: 'From conflicting priorities to unified vision',
      highlight: true,
    },
    {
      label: 'Users Surveyed',
      value: 42,
      description: 'Role-based insights from 4 stakeholder types',
      highlight: true,
    },
    {
      label: 'Pages Wireframed',
      value: 5,
      description: 'Core pages from homepage to impact directory',
      highlight: true,
    },
  ]

  // Timeline data for "How I Created Clarity"
  const approachTimeline = [
    {
      title: 'Survey → shared facts',
      content: (
        <div className="prose prose-zinc dark:prose-invert max-w-none">
          <h3 className="mt-0">Start with data everyone can point to</h3>
          <p>I co-designed a <Tooltip content="Survey logic that shows different questions based on the respondent's role, so each stakeholder type gets relevant questions without unnecessary complexity."><span className="font-bold">role-branched survey</span></Tooltip> in Microsoft Forms. Different questions for SPOs, SFIs, investors, and others. 42 responses. Cleaned the data in Excel, synthesized it in Obsidian.</p>
          <p>The goal wasn't a research deck. It was a single source of truth the whole team could reference when opinions diverged. "Here's what users actually said" ends a lot of circular arguments.</p>
          <div className="my-4">
            <Figure
              src="/images/case-studies/social-finance-fund/SFFSurveyConditionalLogic.png"
              alt="Conditional logic flow showing role-based branching for SPOs, SFIs, investors, and other user types"
              caption="Role-based survey branching. Different stakeholders, different questions."
            />
          </div>
        </div>
      ),
    },
    {
      title: 'Workshops → alignment',
      content: (
        <div className="prose prose-zinc dark:prose-invert max-w-none">
          <h3 className="mt-0">The session that shifted everything</h3>
          <p>One workshop started tense. You could feel the skepticism. I led with listening, made space for candid critique, and kept pointing back to the survey data and the IA draft. No defensiveness, just "here's what we're seeing, what do you think?"</p>
          <p>By the end, the tone had shifted. Not because anyone "won," but because we'd built something together. Future sessions were collaborative instead of resistant. That pivot was more valuable than any deliverable.</p>
        </div>
      ),
    },
    {
      title: 'AI-accelerated concepting',
      content: (
        <div className="prose prose-zinc dark:prose-invert max-w-none">
          <h3 className="mt-0">LLMs as conversation starters</h3>
          <p>I used LLMs to generate multiple sitemap alternatives and page flow options. Not as final designs. As debate fodder. "Here are five ways we could structure this. Which feels closest? What's wrong with it?"</p>
          <p>Faster than sketching everything by hand. Keeps humans in control of the judgment. The AI generates options; the team decides which ones make sense.</p>
        </div>
      ),
    },
    {
      title: 'Wireframes → proof of intent',
      content: (
        <div className="prose prose-zinc dark:prose-invert max-w-none">
          <h3 className="mt-0">Concrete beats abstract</h3>
          <p>Mid- to high-fidelity wireframes in Figma. Homepage, about, articles, impact, directory. Enough detail to support real decisions and an open RFP. Not so polished that we'd get lost debating visual design.</p>
          <p>When stakeholders could see and interact with the structure, abstract disagreements resolved themselves. "I don't like the IA" becomes "I don't like where this specific thing lives." Much easier to fix.</p>
        </div>
      ),
    },
  ]

  // Orbiting circles visual for the Context section - showing stakeholder organizations
  const orbitingCirclesVisual = (
    <OrbitContainer
      height="h-[360px]"
      center={
        <div className="flex size-16 items-center justify-center rounded-full bg-emerald-50/90 text-emerald-800 ring-2 ring-emerald-200 backdrop-blur-sm shadow-lg dark:bg-emerald-900/60 dark:text-emerald-100 dark:ring-emerald-800/60">
          <Handshake className="h-6 w-6" aria-label="Social Finance Fund" />
        </div>
      }
    >
      {/* Outer orbit - stakeholder organizations */}
      <OrbitingCircles radius={150} duration={26} iconSize={50}>
        <div className="flex size-full items-center justify-center rounded-full bg-blue-50 text-blue-700 ring-2 ring-blue-100 dark:bg-blue-950 dark:text-blue-200 dark:ring-blue-900/40 font-semibold text-[11px]">
          Org 1
        </div>
        <div className="flex size-full items-center justify-center rounded-full bg-purple-50 text-purple-700 ring-2 ring-purple-100 dark:bg-purple-950 dark:text-purple-200 dark:ring-purple-900/40 font-semibold text-[11px]">
          Org 2
        </div>
        <div className="flex size-full items-center justify-center rounded-full bg-amber-50 text-amber-700 ring-2 ring-amber-100 dark:bg-amber-950 dark:text-amber-200 dark:ring-amber-900/40 font-semibold text-[11px]">
          Org 3
        </div>
        <div className="flex size-full items-center justify-center rounded-full bg-emerald-50 text-emerald-700 ring-2 ring-emerald-100 dark:bg-emerald-950 dark:text-emerald-200 dark:ring-emerald-900/40 font-semibold text-[11px]">
          Org 4
        </div>
      </OrbitingCircles>

      {/* Inner orbit - process/alignment icons */}
      <OrbitingCircles radius={95} duration={18} reverse iconSize={42}>
        <div className="flex size-full items-center justify-center rounded-full bg-blue-50 text-blue-700 ring-2 ring-blue-100 dark:bg-blue-950 dark:text-blue-200 dark:ring-blue-900/40">
          <Users className="h-6 w-6" />
        </div>
        <div className="flex size-full items-center justify-center rounded-full bg-purple-50 text-purple-700 ring-2 ring-purple-100 shadow-md dark:bg-purple-950/60 dark:text-purple-200 dark:ring-purple-900/40">
          <MessageSquare className="h-6 w-6" />
        </div>
        <div className="flex size-full items-center justify-center rounded-full bg-amber-50 text-amber-700 ring-2 ring-amber-100 shadow-md dark:bg-amber-950/60 dark:text-amber-200 dark:ring-amber-900/40">
          <Network className="h-6 w-6" />
        </div>
      </OrbitingCircles>
    </OrbitContainer>
  )

  return (
    <CaseStudyViewer caseStudy={caseStudy} metrics={metrics}>
      {/* Goal Section */}
      <GoalBlock
        goal="Get four organizations to agree on anything, then ship wireframes they could actually use"
        goalDetail="What started as 'just wireframes' became a diplomacy project. The deliverables mattered less than the alignment."
      />

      {/* Context Section - 50/50 layout with orbiting circles */}
      <SplitSection
        visual={orbitingCirclesVisual}
        align="center"
      >
        <Heading id="context" level={2} className="mt-0">Context</Heading>
        <p>The Social Finance Fund is a government-backed initiative to educate Canadians on social finance. The pitch is compelling: connect regular people to organizations making real impact. Want to support indigenous-owned businesses? Find and compare them. Weaponize capitalism for good. I genuinely love the idea.</p>
        <p>The challenge? Getting it built requires four different organizations to agree on what it should be. That's where things got interesting.</p>
      </SplitSection>


      {/* The Problem Section - 50/50 layout, flipped */}
      <ProseSection className="space-y-8">
        <ProseBlock>
          <Heading id="the-problem" level={2} className="mt-0">The Problem</Heading>
        </ProseBlock>
        <p>Four organizations. Different mandates. One lead org that others were hesitant to follow. No single product owner to make final decisions. Under $10k budget. If you've worked in multi-stakeholder environments, you're already wincing.</p>
        <p>I was brought in by Briteweb to provide UX strategy and structured facilitation. The brief said "wireframes." The actual job was getting people aligned enough that wireframes would even be useful.</p>
        <SplitSection
          align="center"
          flip
          visual={
            <div className="w-full rounded-xl border border-zinc-200 bg-white dark:border-zinc-800 dark:bg-zinc-900/50">
              <div className="p-4">
                <Tree initialExpandedItems={['root', 'org1', 'org2']} initialSelectedId="org1-priorities">
                  <Folder element="Multi-Org Challenge" value="root" isSelectable={false}>
                    <Folder element="Organization 1" value="org1">
                      <File value="org1-priorities">Priorities: Education focus</File>
                      <File value="org1-mandate">Mandate: Public awareness</File>
                    </Folder>
                    <Folder element="Organization 2" value="org2">
                      <File value="org2-priorities">Priorities: Investment focus</File>
                      <File value="org2-mandate">Mandate: Capital deployment</File>
                    </Folder>
                    <Folder element="Organization 3" value="org3">
                      <File value="org3-priorities">Priorities: Policy focus</File>
                      <File value="org3-mandate">Mandate: Regulatory framework</File>
                    </Folder>
                    <File value="conflict" isSelectable={false}>
                      Result: Conflicting priorities, unclear ownership
                    </File>
                  </Folder>
                </Tree>
              </div>
            </div>
          }
        >
          <ul>
            <li><strong>Conflicting priorities:</strong> Education vs. investment vs. policy. Everyone wanted something different.</li>
            <li><strong>Power dynamics:</strong> One org nominally in charge. Others not quite bought in.</li>
            <li><strong>No product owner:</strong> Decisions required consensus. Consensus required trust. Trust was thin.</li>
            <li><strong>Lean budget:</strong> Under $10k. No room for extended discovery or multiple revision rounds.</li>
          </ul>
        </SplitSection>
      </ProseSection>

      {/* Quote Block */}
      <QuoteBlock>
        Sometimes the real UX problem isn't the interface—it's misalignment at the human level.
      </QuoteBlock>

      {/* My Role Section */}
      <ProseSection>
        <ProseBlock>
          <Heading id="my-role" level={2} className="mt-0">My Role</Heading>
          <p>UX strategist and research facilitator, brought in by Briteweb. On paper: survey design, workshop facilitation, IA, wireframes. In practice: professional herder of cats.</p>
          <p><strong>What I optimized for:</strong></p>
          <ul>
            <li><strong>Alignment first:</strong> Shared understanding before shared artifacts. You can't design for people who don't agree on what they're building.</li>
            <li><strong>Concrete over abstract:</strong> Turn vague disagreements into things people could point at and debate.</li>
            <li><strong>Usable deliverables:</strong> IA and wireframes that could support an RFP, not just look good in a presentation.</li>
          </ul>
        </ProseBlock>
      </ProseSection>

      {/* How I Created Clarity */}
      <ProseSection>
        <ProseBlock>
          <Heading id="how-i-created-clarity" level={2} label="Approach">
            How I Created Clarity
          </Heading>
          <p>This was a facilitation challenge wearing a design costume. The wireframes mattered, but they wouldn't matter at all if the group couldn't agree on what they were for. So I started there.</p>
        </ProseBlock>
        <FadeIn delay={0.1}>
          <div className="mt-10">
            <Timeline data={approachTimeline} />
          </div>
        </FadeIn>
      </ProseSection>

      {/* Practical AI */}
      <ProseSection>
        <ProseBlock>
          <Heading id="practical-ai" level={2} label="AI Integration">Practical AI</Heading>
          <p>AI on this project was internal acceleration, not magic. Fewer hours on admin, more hours on the hard stuff: facilitating difficult conversations, building trust, making decisions stick.</p>
          <p><strong>Where it actually helped:</strong></p>
          <ul>
            <li><strong>IA concepting:</strong> Multiple sitemap alternatives generated fast. Not to ship, but to debate. "Here are five options, what's wrong with each?"</li>
            <li><strong>Survey synthesis:</strong> Theme identification from 42 responses. Human-edited for accuracy, but the first pass was quick.</li>
            <li><strong>Content clustering:</strong> Grouping user needs and requirements. Patterns surfaced faster than doing it manually.</li>
            <li><strong>Documentation:</strong> First drafts in Obsidian. More time for facilitation, less time formatting.</li>
          </ul>
          <p>The human work (judgment, relationships, navigating politics) stayed core. AI just freed up bandwidth to do more of it.</p>
        </ProseBlock>
      </ProseSection>

      {/* Outcomes */}
      <ProseSection>
        <ProseBlock className="mb-8">
          <Heading id="outcomes" level={2}>Outcomes</Heading>
          <p>The IA, wireframes, and research package are driving the RFP for phase two. Briteweb is well positioned. More importantly, there's a shared vision now. New partners can slot in without relitigating the fundamentals.</p>
        </ProseBlock>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 my-8">
          <LearningCard 
            title="Survey + Research Hub"
            icon="FileText"
            index={0}
          >
            Role-branched survey, 42 responses, Obsidian synthesis. Single source of truth when opinions diverged.
          </LearningCard>

          <LearningCard 
            title="IA & Sitemap"
            icon="Network"
            index={1}
          >
            AI-assisted variants, refined by hand. Structure that serves all stakeholder types and supports the RFP.
          </LearningCard>

          <LearningCard 
            title="Figma Wireframes"
            icon="FileText"
            index={2}
          >
            Five core pages. Enough fidelity to make decisions, not so polished we'd argue about colors.
          </LearningCard>

          <LearningCard 
            title="Stakeholder Alignment"
            icon="Handshake"
            index={3}
          >
            The hardest deliverable. Four orgs, one shared direction. That pivot from resistant to collaborative.
          </LearningCard>
        </div>

        {/* Wireframe Gallery - placeholder for when images are added */}
        <FadeIn delay={0.1}>
          <div className="my-12">
            <FocusImageGallery 
              images={[
                {
                  src: "/images/case-studies/social-finance-fund/SFFSurveyConditionalLogic.png",
                  alt: "Role-based survey branching logic",
                  caption: "Survey conditional logic ensured relevant questions for each stakeholder type"
                }
                // Additional wireframe images can be added here when available
              ]}
            />
          </div>
        </FadeIn>
      </ProseSection>

      {/* Learnings */}
      <ProseSection>
        <ProseBlock className="mb-8">
          <Heading id="learnings" level={2}>Learnings</Heading>
        </ProseBlock>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 my-8">
          <LearningCard 
            title="Wireframes are diplomacy tools"
            icon="Handshake"
            index={0}
          >
            Abstract disagreements dissolve when people can point at something concrete. "I don't like the direction" becomes "I don't like where this lives." Much easier to solve.
          </LearningCard>

          <LearningCard 
            title="Lightweight beats polished early"
            icon="FileText"
            index={1}
          >
            Obsidian markdown over presentation decks. Fast to update, easy to link, keeps everyone honest. Polish comes later, if it comes at all.
          </LearningCard>

          <LearningCard 
            title="Trust before artifacts"
            icon="MessageSquare"
            index={2}
          >
            In multi-org contexts, the relationship work matters more than the deliverables. A perfect wireframe means nothing if no one trusts the process that created it.
          </LearningCard>
        </div>
      </ProseSection>

      {/* Credits */}
      <FadeIn>
        <section className="mt-16 pt-8 border-t border-zinc-200 dark:border-zinc-700">
          <div className="prose prose-zinc dark:prose-invert max-w-none">
            <h3>Credits</h3>
            <p>Social Finance Fund stakeholder organizations, Briteweb team, and Boann for trusting the process even when it felt uncertain.</p>
          </div>
        </section>
      </FadeIn>
    </CaseStudyViewer>
  )
}
export const dynamic = 'error'
